<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <!-- INPUT NUMBER -->
    <input id="inputNumber" type="number" pattern="^[0-9]+">

    <!-- INPUT TEXT -->
    <input id="inputText" type="text">


    <script>

        // Capturamos el input number: 
        let inputNumber = document.getElementById('inputNumber')

        // Agregamos un event listener para el evento 'input':
        inputNumber.addEventListener('input', function (event) {
            // Obtenemos el valor actual del input
            let value = event.target.value;

            // Convertimos el valor a string para aplicar la expresión regular
            let valueString = value.toString();

            // Expresión regular que solo permite los dígitos del 0 al 9
            let sanitizedValue = valueString.replace(/[^0-9]/g, '');

            // Si el valor ha cambiado, lo actualizamos en el input
            if (valueString !== sanitizedValue) {
                event.target.value = sanitizedValue;
            }
        });

        /*
            // Obtener la posición del cursor antes del cambio:
            let cursorPos = this.selectionStart;

            // Obtener solo los números del valor actual:
            let nuevoValor = this.value.replace(/[^0-9]/g, '');

            // Si el nuevo valor es diferente del valor actual del input
            if (nuevoValor !== this.value) {
                // Calcular cuántos caracteres se eliminaron antes del cursor
                let caracteresEliminados = 0;
                for (let i = 0; i < cursorPos; i++) {
                    if (!/[0-9]/.test(this.value[i])) {
                        caracteresEliminados++;
                    }
                }

                // Actualizar el valor del input
                this.value = nuevoValor;

                // Ajustar la posición del cursor
                cursorPos = Math.max(cursorPos - caracteresEliminados, 0);
                this.setSelectionRange(cursorPos, cursorPos);
            }

            // Actualizar el valor anterior
            valorAnterior = nuevoValor;
        */


        // Prevenir la entrada de e, E, +, - y .
        inputNumber.addEventListener('keydown', function (e) {
            if (['e', 'E', '+', '-', '.'].includes(e.key)) {
                e.preventDefault();
            }
        });

        input.addEventListener('keydown', function (e) {
            // Permitir: backspace, delete, tab, escape, enter, puntos, comas y números
            if ([46, 8, 9, 27, 13, 110, 190].indexOf(e.keyCode) !== -1 ||
                // Permitir: Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
                (e.keyCode === 65 && e.ctrlKey === true) ||
                (e.keyCode === 67 && e.ctrlKey === true) ||
                (e.keyCode === 86 && e.ctrlKey === true) ||
                (e.keyCode === 88 && e.ctrlKey === true) ||
                // Permitir: home, end, left, right
                (e.keyCode >= 35 && e.keyCode <= 39)) {
                // Permitir estas teclas
                return;
            }
            // Asegurar que sea un número y detener el keypress
            if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                e.preventDefault();
            }
        });

        input.addEventListener('paste', function (e) {
            e.preventDefault();
            var pastedText = (e.clipboardData || window.clipboardData).getData('text');
            this.value = pastedText.replace(/[^0-9]/g, '');
        });

        // Función para validar y limpiar cualquier input
        function validarYLimpiarInput(input) {
            if (!input || input.value === undefined || input.value === null) {
                console.warn('Input inválido o undefined');
                return '';
            }

            let valor = input.value.trim();

            // Reducir múltiples espacios a uno solo
            valor = valor.replace(/\s+/g, ' ');

            return valor;
        }



        // Configurar todos los inputs numéricos
        document.querySelectorAll('input[type="number"]').forEach(configurarInputNumerico);

        // Ejemplo de uso para validar inputs al enviar un formulario
        document.querySelector('form').addEventListener('submit', function (e) {
            e.preventDefault();

            let todosInputsValidos = true;

            this.querySelectorAll('input').forEach(function (input) {
                let valorLimpio = validarYLimpiarInput(input);

                if (valorLimpio === '') {
                    console.log(`El input ${input.name || 'sin nombre'} está vacío`);
                    todosInputsValidos = false;
                } else {
                    console.log(`Input ${input.name || 'sin nombre'}: "${valorLimpio}"`);
                    input.value = valorLimpio; // Actualizar el valor del input
                }
            });

            if (todosInputsValidos) {
                console.log('Todos los inputs son válidos, puedes enviar el formulario');
                // Aquí puedes agregar el código para enviar el formulario
            } else {
                console.log('Hay inputs vacíos o inválidos');
            }
        });

        // Configuración específica para updatePriceInput
        let updatePriceInput = document.getElementById('updatePriceInput');
        if (updatePriceInput) {
            configurarInputNumerico(updatePriceInput);
        }
    </script>

</body>

</html>